---
import UserNav from '@components/molecules/userNav/UserNav.svelte';
import Sidebar from '@components/organisms/sidebar/Sidebar.svelte';
import Main from '@components/organisms/main/Main.svelte';
import MainInner from '@components/organisms/main/MainInner.svelte';
import MainContentWrapper from '@components/organisms/main/MainContentWrapper.svelte';
import Header from '@components/organisms/header/Header.svelte';
import MainContent from '@components/organisms/main/MainContent.svelte';
import HeaderPageTitle from '@components/organisms/header/HeaderPageTitle.svelte';
import ButtonToggleTheme from '@components/atoms/buttons/ButtonToggleTheme.svelte';
import ButtonToggleSidebar from '@components/atoms/buttons/ButtonToggleSidebar.svelte';
import Html from './Html.astro';
import { auth } from 'src/util/auth';

export interface Props {
  title: string;
}

const { title } = Astro.props as Props;

const user = auth(Astro);
const pathname = new URL(Astro.request.url).pathname;
const currentPath = pathname.slice(1);
---

<Html title={title}>
  <Sidebar client:load currentPath={currentPath} />
  <Main>
    <MainInner>
      <slot name="sidebar" />
      <MainContentWrapper hasSidebar={Astro.slots.has('sidebar')}>
        <ButtonToggleSidebar client:load />
        <Header>
          <HeaderPageTitle text={title} />

          <div class="flex ml-auto space-x-3">
            <ButtonToggleTheme className="mr-6" client:load />
            {user && <UserNav user={user} client:load />}
          </div>
        </Header>
        <MainContent>
          <slot />
        </MainContent>
      </MainContentWrapper>
    </MainInner>
  </Main>
</Html>
